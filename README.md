
# MINKE's Indexed Ni-Zhan Keypoint Environment

**MINKE 地图数据化引擎** 是一款基于 Rust 开发的、专为《逆战未来》塔防模式设计的次世代地图数据化工具。它是 **MINKE 硬件自动化生态 (ESP32-S3)** 的核心数据生成端。

本工具旨在将感性的“游戏截图”转化为极其精确的、可被机器索引的 ** 纯数字环境数据 (JSON)**，彻底打通从“视觉图纸”到“物理按键”的最后一公里。

讨论群:1075480881
---

## 🌟 核心特性 (Features)

* **🗺️ 纯净的图物分离架构**：静态地形与动态建筑解耦。地图数据仅记录“地形蒙版”与“海拔高度”，极大压缩了数据体积，实现  时间复杂度的极速查询。
* **🎯 浮点数级校准 (Float32 Calibration)**：采用浮点数记录网格大小与偏移量，彻底根除 UI 缩放与分辨率变化带来的累积误差，确保 ESP32 的每一发点击都精准落入网格中心。
* **🔍 无限工作台 (Infinite Canvas)**：基于摄像机矩阵算法，支持平滑的鼠标中键拖动 (Pan) 与以鼠标为中心的滚轮缩放 (Zoom, 10% - 1000%)。
* **⛰️ 高度映射笔刷 (Elevation Brush)**：类似《我的世界》的操作体验。使用红/绿/黄/蓝/紫五色笔刷，直接在平面底图上绘制出三维的地形高度信息。
* **📈 动态内存伸缩**：实时调整地图网格维度 (Rows x Cols)，底层数据安全扩容，历史涂鸦绝不丢失。

## 🚀 快速开始 (Getting Started)

### 1. 运行环境

请确保你的电脑上安装了最新版的 [Rust 工具链](https://www.rust-lang.org/tools/install)。

### 2. 克隆与运行

在项目根目录下放置一张名为 `1.png` 的游戏地图截图作为底图。

```bash
git clone https://github.com/your-username/minke-map-editor.git
cd minke-map-editor
cargo run --release

```

## 🎮 操作指南 (How to Use)

1. **底图对齐**：使用左侧面板调整 `网格大小`、`原点 X` 和 `原点 Y`，使绿色网格完美贴合游戏底图。
2. **绘制防线**：在左侧面板选择 **画笔工具**（海拔高度）：
* 🔴 `障碍物 (-1)`：不可放置建筑的区域（如深渊、障碍）。
* 🟢 `基础平地 (0)`：普通地面出怪口。
* 🟡 / 🔵 / 🟣 `高台 (1/2/3)`：根据游戏中的视觉高度，分别标记不同海拔的高台。


3. **快捷擦除**：在任何模式下，**长按鼠标右键**涂抹，即可将该区域快速恢复为绿色平地。
4. **导出**：点击左下角按钮，极速导出为标准 JSON 格式。

## 📦 输出数据规范 (Output JSON Spec)

导出的 `minke_map_data.json` 采用极限压缩的纯数字矩阵格式，专为 Python 下游驱动解析而设计：

```json
{
  "map_name": "Ni-Zhan_Exported_Map",
  "meta": {
    "grid_pixel_size": 32.5,   // 浮点数精度网格
    "offset_x": 12.0,
    "offset_y": 5.0
  },
  "layers": [
    {
      "major_z": 0,
      "name": "Major_Layer_0",
      // 底层矩阵：-1=障碍, 0=平地, 1/2/3=高台
      "elevation_grid": [
        [0, 0, 0, -1],
        [0, 1, 1, -1]
      ]
    }
  ]
}

```

## 🔗 生态集成 (Ecosystem)

本工具是 **MINKE** 生态的起步点。导出的 JSON 数据将直接被输送至：

1. **MINKE Python Driver**：解析地图 JSON，结合 A* 寻路算法，生成带有贝塞尔曲线 (Bezier) 缓动的拟人化点击轨迹。
2. **MINKE Hardware Emulator (ESP32-S3)**：接收 Python 指令，通过 TinyUSB 模拟底层硬件键盘/鼠标，实现物理级别的完美避检。

---

*“用数据重构战场，以代码掌控未来。”*

---
